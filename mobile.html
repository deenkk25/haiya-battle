<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ハイヤーバトル - スマホ版モック</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    /* ---------- ベース ---------- */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050710;
      color: #f6f6f6;
    }

    body {
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      padding: 8px 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    header {
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.08em;
      padding: 4px 0 2px;
    }

    header span.sub {
      display: block;
      font-size: 11px;
      opacity: 0.7;
      margin-top: -2px;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    h2 {
      font-size: 13px;
      margin: 0 0 4px;
      opacity: 0.9;
    }

    /* ---------- 盤面 ---------- */
    .board-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(8, 1fr);
      width: min(92vw, 92vh);
      height: min(92vw, 92vh);
      max-width: 440px;
      max-height: 440px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 0 24px rgba(0, 0, 0, 0.5);
      background: radial-gradient(circle at top, #222844 0, #050710 65%);
    }

    .cell {
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      position: relative;
      color: #e4e7ff;
    }

    .cell:nth-child(odd) {
      background: rgba(255, 255, 255, 0.02);
    }

    .cell:nth-child(even) {
      background: rgba(0, 0, 0, 0.15);
    }

    .cell::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 6px;
      border: 1px solid transparent;
      pointer-events: none;
    }

    .cell.selected {
      outline: 2px solid #ffd86b;
      outline-offset: -2px;
    }

    .cell.selected::after {
      border-color: rgba(255, 216, 107, 0.6);
    }

    .cell .coord {
      position: absolute;
      bottom: 2px;
      right: 3px;
      font-size: 8px;
      opacity: 0.4;
    }

    .piece {
      font-size: 15px;
    }

    .piece.white {
      color: #f9f9ff;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
    }

    .piece.black {
      color: #ffc857;
      text-shadow: 0 0 6px rgba(255, 200, 87, 0.6);
    }

    /* ---------- 手札 ---------- */
    .hand {
      padding: 6px 8px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(10, 16, 42, 0.85), rgba(10, 5, 30, 0.95));
      box-shadow: 0 0 14px rgba(0, 0, 0, 0.6);
    }

    .hand-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 4px;
    }

    .turn-badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
    }

    .turn-badge span {
      font-weight: 600;
    }

    .hand-cards {
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .card {
      flex: 1;
      min-width: 0;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.12), rgba(7, 9, 24, 0.95));
      color: inherit;
      padding: 6px 4px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 11px;
      text-align: left;
      outline: none;
    }

    .card-title {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .card-type {
      font-size: 9px;
      opacity: 0.8;
    }

    .card-desc {
      font-size: 9px;
      opacity: 0.85;
      line-height: 1.3;
    }

    .card.selected {
      border-color: #ffd86b;
      box-shadow: 0 0 0 1px rgba(255, 216, 107, 0.6), 0 0 12px rgba(255, 216, 107, 0.4);
    }

    /* ---------- アクションパネル ---------- */
    .action-panel {
      padding: 6px 8px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(82, 107, 255, 0.25), rgba(7, 8, 20, 0.98));
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .selected-info {
      font-size: 11px;
      line-height: 1.4;
      opacity: 0.92;
    }

    .selected-info strong {
      font-weight: 600;
    }

    .action-buttons {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .btn {
      flex: 1;
      padding: 8px 4px;
      font-size: 12px;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffd86b, #ff9f43);
      color: #231b08;
      box-shadow: 0 0 12px rgba(255, 189, 89, 0.7);
    }

    .btn-secondary {
      background: rgba(14, 18, 42, 0.9);
      color: #f2f2ff;
      border: 1px solid rgba(255, 255, 255, 0.16);
    }

    .btn:disabled {
      opacity: 0.4;
      box-shadow: none;
    }

    /* ---------- ログ ---------- */
    .log-panel {
      margin-top: 2px;
    }

    .toggle-log {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 6px 8px;
      font-size: 11px;
      background: rgba(255, 255, 255, 0.06);
      color: #f6f6ff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .toggle-log span.chevron {
      font-size: 12px;
    }

    .log-area {
      margin-top: 4px;
      padding: 6px 8px;
      border-radius: 12px;
      background: rgba(3, 5, 14, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.08);
      max-height: 160px;
      overflow-y: auto;
      font-size: 11px;
    }

    .hidden {
      display: none;
    }

    .status-line {
      opacity: 0.85;
      margin-bottom: 4px;
    }

    .log-entry {
      padding: 2px 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    footer {
      margin-top: 4px;
      font-size: 9px;
      text-align: center;
      opacity: 0.55;
    }

    /* ---------- 小さい画面向け微調整 ---------- */
    @media (max-height: 720px) {
      .board {
        width: min(86vw, 86vh);
        height: min(86vw, 86vh);
      }

      .log-area {
        max-height: 120px;
      }
    }

    @media (max-height: 640px) {
      .board {
        width: min(80vw, 80vh);
        height: min(80vw, 80vh);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      HAIYA-BATTLE
      <span class="sub">スマホ版モック / 縦持ちUI</span>
    </header>

    <main>
      <!-- 盤面 -->
      <section class="board-wrapper">
        <div id="board" class="board"></div>
      </section>

      <!-- 手札 -->
      <section class="hand" id="hand">
        <div class="hand-row">
          <h2>手札</h2>
          <div class="turn-badge">
            ターン：<span id="turnPlayerLabel">白のターン</span>
          </div>
        </div>
        <div class="hand-cards">
          <!-- ※ここはモック。実装時に実際のカードリストと連携させてOK -->
          <button class="card" data-card-id="blessing">
            <div class="card-title">フォースの導き</div>
            <div class="card-type">支援 / 単体強化</div>
            <div class="card-desc">自軍の駒1体を安全な位置へ導く。</div>
          </button>
          <button class="card" data-card-id="shield">
            <div class="card-title">守護結界</div>
            <div class="card-type">結界 / 範囲</div>
            <div class="card-desc">選んだマス周辺の味方を1ターン守る。</div>
          </button>
          <button class="card" data-card-id="meteor">
            <div class="card-title">天変地異</div>
            <div class="card-type">攻撃 / 広範囲</div>
            <div class="card-desc">指定マスに大ダメージ。巻き込み注意。</div>
          </button>
        </div>
      </section>

      <!-- アクションパネル -->
      <section class="action-panel">
        <div class="selected-info">
          <div><strong>選択中のカード：</strong><span id="selectedCardText">なし</span></div>
          <div><strong>選択中のマス：</strong><span id="selectedCellText">なし</span></div>
        </div>
        <div class="action-buttons">
          <button id="btnConfirm" class="btn btn-primary" disabled>この内容で実行</button>
          <button id="btnCancel" class="btn btn-secondary" disabled>キャンセル</button>
        </div>
      </section>

      <!-- ログ・戦況 -->
      <section class="log-panel">
        <button id="toggleLog" class="toggle-log">
          <span>戦況・前ターン / ログを表示</span>
          <span id="chevron" class="chevron">▼</span>
        </button>
        <div id="logArea" class="log-area hidden">
          <div class="status-line" id="statusView">戦況：まだ静かな様子だ…</div>
          <div class="status-line" id="lastTurnView">前ターン：まだ行動はありません。</div>
          <div id="logList"></div>
        </div>
      </section>
    </main>

    <footer>
      ※ 現在はスマホUIモックです。ルール本体はPC版と共通ロジックに接続予定。
    </footer>
  </div>

  <script>
    // ===============================
    // 簡易ゲーム状態（モック）
    // ===============================
    const BOARD_SIZE = 8;
    const boardEl = document.getElementById("board");
    const turnPlayerLabel = document.getElementById("turnPlayerLabel");
    const selectedCardText = document.getElementById("selectedCardText");
    const selectedCellText = document.getElementById("selectedCellText");
    const btnConfirm = document.getElementById("btnConfirm");
    const btnCancel = document.getElementById("btnCancel");
    const statusView = document.getElementById("statusView");
    const lastTurnView = document.getElementById("lastTurnView");
    const logList = document.getElementById("logList");
    const toggleLogBtn = document.getElementById("toggleLog");
    const logArea = document.getElementById("logArea");
    const chevron = document.getElementById("chevron");

    let currentPlayer = "white"; // "white" or "black"
    let selectedCardId = null;
    let selectedCardLabel = "";
    let selectedCell = null; // { row, col }
    let cells = [];

    // ===============================
    // 盤面生成（ここに既存ロジックを組み込んでOK）
    // ===============================
    function createBoard() {
      boardEl.innerHTML = "";
      cells = [];
      for (let row = 0; row < BOARD_SIZE; row++) {
        for (let col = 0; col < BOARD_SIZE; col++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.row = row;
          cell.dataset.col = col;

          // 中央あたりに仮の駒を置いて雰囲気だけ
          const pieceEl = document.createElement("div");
          pieceEl.className = "piece";
          if (row === 0 && col === 4) {
            pieceEl.textContent = "♔";
            pieceEl.classList.add("white");
          } else if (row === 7 && col === 3) {
            pieceEl.textContent = "♚";
            pieceEl.classList.add("black");
          }
          if (pieceEl.textContent) {
            cell.appendChild(pieceEl);
          }

          const coord = document.createElement("div");
          coord.className = "coord";
          coord.textContent = `${row + 1},${col + 1}`;
          cell.appendChild(coord);

          cell.addEventListener("click", () => onCellClick(row, col, cell));
          boardEl.appendChild(cell);
          cells.push(cell);
        }
      }
    }

    // ===============================
    // 手札（カード）選択
    // ===============================
    function setupHand() {
      const cardEls = document.querySelectorAll(".card");
      cardEls.forEach((cardEl) => {
        cardEl.addEventListener("click", () => {
          const id = cardEl.dataset.cardId;
          const titleEl = cardEl.querySelector(".card-title");
          const label = titleEl ? titleEl.textContent.trim() : id;

          if (selectedCardId === id) {
            // 2回タップで解除
            selectedCardId = null;
            selectedCardLabel = "";
          } else {
            selectedCardId = id;
            selectedCardLabel = label;
          }
          updateCardSelectionUI();
          updateActionState();
        });
      });
    }

    function updateCardSelectionUI() {
      const cardEls = document.querySelectorAll(".card");
      cardEls.forEach((cardEl) => {
        if (cardEl.dataset.cardId === selectedCardId) {
          cardEl.classList.add("selected");
        } else {
          cardEl.classList.remove("selected");
        }
      });

      selectedCardText.textContent = selectedCardLabel || "なし";
    }

    // ===============================
    // マス選択
    // ===============================
    function onCellClick(row, col, cellEl) {
      if (selectedCell && selectedCell.row === row && selectedCell.col === col) {
        // 同じマスを2回タップで解除
        selectedCell = null;
      } else {
        selectedCell = { row, col };
      }
      updateCellSelectionUI();
      updateActionState();
    }

    function updateCellSelectionUI() {
      cells.forEach((cell) => cell.classList.remove("selected"));
      if (selectedCell) {
        const { row, col } = selectedCell;
        const target = cells.find(
          (c) => Number(c.dataset.row) === row && Number(c.dataset.col) === col
        );
        if (target) {
          target.classList.add("selected");
        }
        selectedCellText.textContent = `${row + 1} 行 ${col + 1} 列`;
      } else {
        selectedCellText.textContent = "なし";
      }
    }

    // ===============================
    // アクション（実行 / キャンセル）
    // ===============================
    function updateActionState() {
      const ready = !!selectedCardId && !!selectedCell;
      btnConfirm.disabled = !ready;
      btnCancel.disabled = !selectedCardId && !selectedCell;
    }

    function switchTurn() {
      currentPlayer = currentPlayer === "white" ? "black" : "white";
      turnPlayerLabel.textContent = currentPlayer === "white" ? "白のターン" : "黒のターン";
    }

    function addLogEntry(text) {
      const div = document.createElement("div");
      div.className = "log-entry";
      div.textContent = text;
      logList.appendChild(div);
      logList.scrollTop = logList.scrollHeight;
    }

    btnConfirm.addEventListener("click", () => {
      if (!selectedCardId || !selectedCell) return;

      const { row, col } = selectedCell;
      const playerLabel = currentPlayer === "white" ? "白" : "黒";
      const logText = `【${playerLabel}】「${selectedCardLabel}」を ${row + 1}行${col + 1}列 に使用した。`;

      lastTurnView.textContent = `前ターン：${logText}`;
      statusView.textContent = `戦況：${playerLabel}が「${selectedCardLabel}」を発動中…`;
      addLogEntry(logText);

      // ※ 実際のゲームロジックはここに接続
      // TODO: ここで既存のハイヤーバトルの処理を呼び出す
      // 例）applyCardEffect(currentPlayer, selectedCardId, selectedCell);

      // 選択リセット
      selectedCardId = null;
      selectedCardLabel = "";
      selectedCell = null;
      updateCardSelectionUI();
      updateCellSelectionUI();
      updateActionState();

      // ターン交代
      switchTurn();
    });

    btnCancel.addEventListener("click", () => {
      selectedCardId = null;
      selectedCardLabel = "";
      selectedCell = null;
      updateCardSelectionUI();
      updateCellSelectionUI();
      updateActionState();
    });

    // ===============================
    // ログエリア開閉
    // ===============================
    toggleLogBtn.addEventListener("click", () => {
      const isHidden = logArea.classList.contains("hidden");
      if (isHidden) {
        logArea.classList.remove("hidden");
        chevron.textContent = "▲";
      } else {
        logArea.classList.add("hidden");
        chevron.textContent = "▼";
      }
    });

    // ===============================
    // 初期化
    // ===============================
    createBoard();
    setupHand();
    updateActionState();
  </script>
</body>
</html>
